<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="icon" href="/assets/images/favicon.ico">

<title>怦然心動的功能性更新：Amazon ECS 終於支援任務定義 (Task Definition) 刪除 | Eason Tech Talk</title>

<!-- Handle Multiple Language SEO -->

<!--meta property="og:url" content="https://easontechtalk.com/tw/ecs-support-task-definition-deletion/" /-->

<meta http-equiv="Content-Language" content="tw">
<link rel="alternate" hreflang="en" href="https://easontechtalk.com"/>
<link rel="alternate" hreflang="tw" href="https://easontechtalk.com/tw/"/>

<!-- Handle Multiple Language SEO End -->

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>怦然心動的功能性更新：Amazon ECS 終於支援任務定義 (Task Definition) 刪除 | Eason Tech Talk</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="怦然心動的功能性更新：Amazon ECS 終於支援任務定義 (Task Definition) 刪除" />
<meta name="author" content="eason" />
<meta property="og:locale" content="en_us" />
<meta name="description" content="自 2015 年 Amazon ECS 正式釋出，提供了支援在 AWS 上運行容器工作負載的成熟解決方案。然而，僅支援 DeregisterTaskDefinition API1 可以取消註冊特定的任務定義 (Task Definition) 版本。 Amazon ECS API - DeregisterTaskDefinition &#8617;" />
<meta property="og:description" content="自 2015 年 Amazon ECS 正式釋出，提供了支援在 AWS 上運行容器工作負載的成熟解決方案。然而，僅支援 DeregisterTaskDefinition API1 可以取消註冊特定的任務定義 (Task Definition) 版本。 Amazon ECS API - DeregisterTaskDefinition &#8617;" />
<link rel="canonical" href="https://easontechtalk.com/tw/ecs-support-task-definition-deletion/" />
<meta property="og:url" content="https://easontechtalk.com/tw/ecs-support-task-definition-deletion/" />
<meta property="og:site_name" content="Eason Tech Talk" />
<meta property="og:image" content="https://easontechtalk.com/assets/images/2023/ecs-support-task-definition-deletion/cover.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-03-10T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://easontechtalk.com/assets/images/2023/ecs-support-task-definition-deletion/cover.png" />
<meta property="twitter:title" content="怦然心動的功能性更新：Amazon ECS 終於支援任務定義 (Task Definition) 刪除" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"eason"},"dateModified":"2023-03-10T00:00:00+00:00","datePublished":"2023-03-10T00:00:00+00:00","description":"自 2015 年 Amazon ECS 正式釋出，提供了支援在 AWS 上運行容器工作負載的成熟解決方案。然而，僅支援 DeregisterTaskDefinition API1 可以取消註冊特定的任務定義 (Task Definition) 版本。 Amazon ECS API - DeregisterTaskDefinition &#8617;","headline":"怦然心動的功能性更新：Amazon ECS 終於支援任務定義 (Task Definition) 刪除","image":"https://easontechtalk.com/assets/images/2023/ecs-support-task-definition-deletion/cover.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://easontechtalk.com/tw/ecs-support-task-definition-deletion/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://easontechtalk.com/assets/images/logo.png"},"name":"eason"},"url":"https://easontechtalk.com/tw/ecs-support-task-definition-deletion/"}</script>
<!-- End Jekyll SEO tag -->


<link href="/assets/css/theme.css" rel="stylesheet">

<!-- custom CSS - Remove this if you don't use it or choose to customize the stylesheet with sass-->
<link href="/assets/css/custom.css" rel="stylesheet">
<!-- custom CSS end-->
    
       
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3QPJPEHDZP"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-3QPJPEHDZP');
</script>

   
</head>   
    

<body class="layout-post">

    
<!-- Menu Navigation
================================================== -->
<div class="navigation-wrap start-header start-style">
    <nav class="navbar navbar-expand-lg">
        <div class="container">

          <a class="navbar-brand text-dark font-weight-bold big d-flex align-items-center" href="/tw/">
          
          <img class="mr-2" src="/assets/images/logo.png" alt="logo"> 
          
          </a> | 
          

          <div class="d-flex align-items-center">
            
            <span class="ml-3 text-muted small">Follow</span>

            
            
            
      
            
            <a class="d-inline-block social-icon" target="_blank" href="https://www.facebook.com/EasonTechTalk">
              <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="currentColor" class="bi bi-facebook" viewBox="0 0 16 16">
              <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/>
            </svg>
            </a>
            

          </div>
    
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
              <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
            </svg>
          </button>
          
          <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto font-weight-bold d-flex align-items-center">
              
              <li class="nav-item">
                <a class="nav-link px-3 " href="/tw/" alt="首頁">首頁</a>
              </li>
              
              <li class="nav-item">
                <a class="nav-link px-3 " href="/tw/about/" alt="關於">關於</a>
              </li>
              
              <li class="nav-item">
                <a class="nav-link px-3 ml-2 btn btn-dark text-white px-3" href="/?" alt="English">English</a>
              </li>
              
            </ul>
          </div>

        </div>
      </nav>
    </div>  

    
<!-- Container
================================================== -->    
<main class="container">   
      <!-- Begin Article
================================================== -->

	<div class="row">
		

		<!-- Post -->        
        
        
		<div class="col-sm-8">
            <!-- Post Featured Image -->
			<img class="featured-image img-fluid rounded" src="/assets/images/2023/ecs-support-task-definition-deletion/cover.png" alt="怦然心動的功能性更新：Amazon ECS 終於支援任務定義 (Task Definition) 刪除">
			<!-- End Featured Image -->
			<div class="mainheading">             
                
                <!-- Post Categories -->
                <div class="after-post-tags">
                    <ul class="tags">
                        
                        
                        <li>
                         <a href="/tw/categories#amazon-elastic-container-service-ecs">Amazon Elastic Container Service (ECS)</a>
                        </li>
                        
                        <li>
                         <a href="/tw/categories#container">Container</a>
                        </li>
                        
                    </ul>
                </div>
                <!-- End Categories -->
                
                <!-- Post Title -->
				<h1 class="posttitle">怦然心動的功能性更新：Amazon ECS 終於支援任務定義 (Task Definition) 刪除</h1> 
                
			</div>

			

			<!-- Post Content -->
			<div class="article-post serif-font">
				<p>自 2015 年 Amazon ECS 正式釋出，提供了支援在 AWS 上運行容器工作負載的成熟解決方案。然而，僅支援 DeregisterTaskDefinition API<sup id="fnref:DeregisterTaskDefinition-API" role="doc-noteref"><a href="#fn:DeregisterTaskDefinition-API" class="footnote" rel="footnote">1</a></sup> 可以取消註冊特定的任務定義 (Task Definition) 版本。</p>

<p>但是，在這樣的設計下，不免會遇到需要刪除過時或未使用的任務定義 (Task Definition) 的情況。即使過了多年，Amazon ECS 仍不支持刪除任務定義 (Task Definition) 資源，這讓許多 Amazon ECS 使用者想知道究竟什麼時候 ECS 才會支任務定義 (Task Definition) 的刪除功能。<sup id="fnref:ecs-fr-685" role="doc-noteref"><a href="#fn:ecs-fr-685" class="footnote" rel="footnote">2</a></sup></p>

<p>千呼萬盼，Amazon ECS 終於支持對任務定義 (Task Definition) 刪除功能。</p>

<h2 id="有哪些改變">有哪些改變？</h2>

<p>2023 年 2 月 27 日，Amazon ECS 正式宣布支援刪除未使用 (<code>INACTIVE</code>) 狀態的任務定義版本 (Task Definition Revisions)。<sup id="fnref:whats-new-ecs-task-definition-deletion" role="doc-noteref"><a href="#fn:whats-new-ecs-task-definition-deletion" class="footnote" rel="footnote">3</a></sup></p>

<p>使用 ECS 並且當你建立一個任務定義 (Task Definition) 時，每次都會自動為其建立一個新版本 (例如：<code>myTaskDefinition:1</code>, <code>myTaskDefinition:2</code> … 等)。每個版本都是不可變更，這意味著，一旦該資源被建立，它就不能被刪除或修改。即使你爲任務定義 (Task Definition) 刪除所有的版本 (Revision)，也只是將版本的狀態由 <code>ACTIVE</code> 更改為 <code>INACTIVE</code>，該版本仍然存在，並且在 AWS 帳號中仍然可以被檢視。</p>

<p>在這個功能被支援之前，使用者只能將任務定義版本 (Task Definition Revision) 標記為 <code>INACTIVE</code>，但無法刪除。</p>

<p>現在這項功能改進可以讓你通過 Amazon ECS 控制台或通過編寫程式的方式刪除未使用的任務定義版本 (Task Definition Revision)。可以永久刪除不再需要或包含不需要的配置的任務定義版本 (Task Definition Revision)，簡化了資源管理並改善了安全問題。</p>

<p><img src="/assets/images/2023/ecs-support-task-definition-deletion/ecs-console-deletion-option.png" alt="Task definition deletion option" /></p>

<h2 id="為什麼能刪任務定義-task-definition-這麼重要">為什麼能刪任務定義 (Task Definition) 這麼重要？</h2>

<p>一種常見的場景即為當容器程式於運行階段存在需要存取特定資訊、憑證或是密文資訊時，常使用環境變數做為參數傳遞 (例如：連接到特定的資料庫)。</p>

<p>透過環境變數將您的憑證傳遞給容器時，如果沒有意識到任務定義 (Task Definition) 不會被刪除，可能會使得你意外地將帳號密碼留在可讀的資源中，暴露不必要的安全風險。例如：</p>

<pre><code class="language-json">{
    "family": "",
    "containerDefinitions": [
        {
            "name": "",
            "image": "mysql",
            ...
            "environment": [
                {
                    "name": "MYSQL_ROOT_PASSWORD",
                    "value": "mySecretPassword"
                }
            ],
            ...
        }
    ],
    ...
}
</code></pre>

<p>在過去，任務定義 (Task Definition) 僅能設定為 <code>INACTIVE</code> 狀態，並且無法刪除。</p>

<p>如果帳號中的任一 IAM User 或 IAM Role 具有描述任務定義 (Task Definition) 的權限，則他們就可以查看你可能不希望他們訪問的憑證數據。</p>

<pre><code class="language-bash">$ aws ecs describe-task-definition --task-definition myTaskDefinition:2

{
    "taskDefinition": {
        "containerDefinitions": [
            {
                "name": "web-service",
                "environment": [
                    {
                        "name": "MYSQL_ROOT_PASSWORD",
                        "value": "mySecretPassword"
                    }
                ],
                ...
            }
        ],
        "family": "myTaskDefinition",
        "revision": 2,
        "status": "INACTIVE",
        ...
}
</code></pre>

<p>由於任務定義 (Task Definition) 可能會在 <code>INACTIVE</code> 狀態下洩露敏感細節，因此，針對這項問題，通常建議使用 AWS Secrets Manager 或 AWS Systems Manager Parameter Store，這兩個 AWS 服務都支援將敏感資訊注入到容器環境變數中而不會直接地被看到相關的敏感資訊。</p>

<p>但現在，無論你是否有使用 AWS Secrets Manager 或 AWS Systems Manager Parameter Store 存放這些敏感資訊，你都可以在 AWS 控制台上永久刪除任務定義 (Task Definition)，或是使用 DeleteTaskDefinitions <sup id="fnref:DeleteTaskDefinitions-API" role="doc-noteref"><a href="#fn:DeleteTaskDefinitions-API" class="footnote" rel="footnote">4</a></sup> API 以程式方法呼叫或是採用 AWS CLI 命令執行刪除：</p>

<pre><code>$ aws ecs delete-task-definitions --task-definitions &lt;task name:revision&gt;
</code></pre>

<h2 id="總結">總結</h2>

<p>在 Amazon ECS 釋出的 8 年後，ECS 終於支援任務定義 (Task Definition) 刪除功能，不必再煩惱看到一堆 <code>INACTIVE</code> 狀態的資源以及不小心暴露憑證資訊的安全性風險。</p>

<p>多麽讓人怦然心動的功能性更新！</p>

<h2 id="參考資源">參考資源</h2>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:DeregisterTaskDefinition-API" role="doc-endnote">
      <p><a href="https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeregisterTaskDefinition.html">Amazon ECS API - DeregisterTaskDefinition</a> <a href="#fnref:DeregisterTaskDefinition-API" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:ecs-fr-685" role="doc-endnote">
      <p><a href="https://github.com/aws/containers-roadmap/issues/685">[ECS] [request]: Delete task definitions #685</a> <a href="#fnref:ecs-fr-685" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:whats-new-ecs-task-definition-deletion" role="doc-endnote">
      <p><a href="https://aws.amazon.com/about-aws/whats-new/2023/02/amazon-ecs-deletion-inactive-task-definition-revisions/">Amazon ECS now supports deletion of inactive task definition revisions</a> <a href="#fnref:whats-new-ecs-task-definition-deletion" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:DeleteTaskDefinitions-API" role="doc-endnote">
      <p><a href="https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeleteTaskDefinitions.html">Amazon ECS API - DeleteTaskDefinitions</a> <a href="#fnref:DeleteTaskDefinitions-API" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

                <div class="clearfix"></div>
			</div>

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2023-03-10">10 Mar 2023</time></span>           
                
                </small>
            </p>
            
			
            
            <!-- Prev/Next -->
            <div class="row PageNavigation mt-4 prevnextlinks d-flex justify-content-between">
              
                <div class="col-md-6 rightborder pl-0">
                    <a class="thepostlink" href="https://easontechtalk.com/tw/launch-ecs-task-with-bottlerocket/">&laquo; Amazon ECS Bottlerocket 簡介: 在 Bottlerocket 上運行容器和任務 (Task)</a>
                </div>
              
              
                <div class="col-md-6 text-right pr-0">
                    <a class="thepostlink" href="https://easontechtalk.com/tw/nsa-kubernetes-hardening-guide/">解析美國國安局 (NSA) 和 CISA 釋出的 Kubernetes 強化指南 &raquo;</a>
                </div>
              
            </div>
            <!-- End Prev/Next -->
            
            
             <!-- Author Box -->
                				
				<div class="row post-top-meta">
					<div class="col-md-2">
						<img class="author-thumb" src="/assets/images/authors/eason.jpg" alt="Eason Cao">
					</div>
					<div class="col-md-10">
						<a target="_blank" class="link-dark" href="https://easoncao.com">Eason Cao</a><a target="_blank" href="https://twitter.com/EasonTechTalk" class="btn follow">Follow</a>
						<span class="author-description">Eason is an engineer working at FANNG and living in Europe. He was accredited as AWS Professional Solution Architect, AWS Professional DevOps Engineer and CNCF Certified Kubernetes Administrator. He started his Kubernetes journey in 2017 and enjoys solving real-world business problems.</span>						
					</div>
				</div>				
                
            
            
            <!-- Begin Comments
            ================================================== -->
            <section>
            <div id="comments">                          
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'eason-tech-talk'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>
 
            </div>
            </section>
            <!--End Comments
            ================================================== -->
            
            

		</div>
		<!-- End Post -->


        

		<!-- Sidebar -->
        <div class="col-sm-4">
            <div class="sidebar sticky-top">        
	<!-- Table of Content (toc) -->
	
		<div class="sidebar-section">
			<h5><span>Table of Content</span></h5>
			<ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#有哪些改變">有哪些改變？</a></li>
<li class="toc-entry toc-h2"><a href="#為什麼能刪任務定義-task-definition-這麼重要">為什麼能刪任務定義 (Task Definition) 這麼重要？</a></li>
<li class="toc-entry toc-h2"><a href="#總結">總結</a></li>
<li class="toc-entry toc-h2"><a href="#參考資源">參考資源</a></li>
</ul>
		</div>
	
	<!-- End Table of Content (toc) -->

    <div class="sidebar-section">
        <h5><span>Newsletter</span></h5>
        
<!-- Begin Newsletter Signup Form (TW) -->
<link href="https://cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; }
	/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="https://docs.google.com/forms/d/e/1FAIpQLSey911rk4FWQITz4_xqIcB7qSRuQdutYYS-Sv5Zmk7flXc1Ww/formResponse" method="post" id="mc-embedded-subscribe-form" class="validate" target="_blank">
	<div id="mc_embed_signup_scroll">
	<h2>訂閱並取得更新</h2>

    <div class="mc-field-group">
        <input name="entry.2059009175" type="email" id="email" class="required email" placeholder="E-mail" required="required">
        <input name="entry.656138904" type="hidden" id="name" class="" placeholder="Name">
        <input name="entry.461682337" type="hidden" id="language" value="en">
    </div>
	<div id="mce-responses" class="clear">
		<div class="response" id="mce-error-response" style="display:none"></div>
		<div class="response" id="mce-success-response" style="display:none"></div>
	</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
	<div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_45bf394e4f5830ed557d64a9f_2f88109ae9" tabindex="-1" value=""></div>
	<div class="clear"><input type="submit" value="免費訂閱" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
	</div>
</form>

</div>
<script type='text/javascript'>
window.onload = function() {
    $(function() {
        $('#mc_embed_signup form').on("submit", function(e) {
            e.preventDefault();
            $('#mc_embed_signup #mce-error-response').hide();
            $('#mc_embed_signup #mce-success-response').hide();

            var email = $("#mc_embed_signup input#email");
            $.ajax({
                url: "https://docs.google.com/forms/d/e/1FAIpQLSey911rk4FWQITz4_xqIcB7qSRuQdutYYS-Sv5Zmk7flXc1Ww/formResponse",
                type: "POST",
                data: {
                    'entry.2059009175': email.val()
                    // 'entry.656138904': name,
                    // 'entry.461682337': language,
                },
                cache: false,
                crossDomain: true,
                statusCode: {
                    0: function() {
                        // CORS issue may only get statsu code 0 but Google got the data
                        $('#mc_embed_signup #mce-success-response').text('請求已送出！').show();
                    },
                    200: function() {
                        // Success message
                        $('#mc_embed_signup #mce-success-response').text('你已經加入至訂閱清單！').show();
                        email.val('') // clear the input
                    },
                    400: function() {
                        // Fail message
                        $('#mc_embed_signup #mce-error-response').text('訂閱失敗，請檢查是否符合格式並重試。').show();
                    },
                    403: function() {
                        // Fail message
                        $('#mc_embed_signup #mce-error-response').text('訂閱失敗，請檢查是否符合格式並重試。').show();
                    }
                }
            })
        });
    });
}
</script>
<!--End mc_embed_signup-->



    </div>
    <!-- div class="sidebar-section">
        <h5><span>Your Ad Here</span></h5>
        <img src="/assets/images/ad.png">
    </div -->
</div>

        </div>

	</div>

<!-- End Article
================================================== -->
  
</main>

<!-- Footer
================================================== -->    
<footer class="footer container text-center">  

  <ul class="p-0 mb-1 small">
    
    <li>
      <a href="/tw/" alt="回首頁">回首頁</a>
    </li>
    
    <li>
      <a href="/tw/privacy-policy/" alt="Privacy Policy">Privacy Policy</a>
    </li>
    
    </ul>
    <div class="copyright small">
       Copyright © Eason Tech Talk. All rights reserved.
    </div>
</footer>

<!-- JavaScript
================================================== -->    
<script src="/assets/js/jquery.min.js"></script>   
<script src="/assets/js/bootstrap.min.js"></script>   
<script src="/assets/js/theme.js"></script>    
    
</body>
    
</html>
